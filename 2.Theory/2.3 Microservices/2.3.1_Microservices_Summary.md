### Общие моменты по микросервисам

#### Теорема CAP
- Consistency – согласованность
- Availability – доступность
- Partition tolerance – устойчивость к разрывам

#### Согласованость данных
**Согласованность данных** — это свойство, гарантирующее, что данные в системе остаются правильными и соответствуют определённым правилам после выполнения операций. Это важно как для локальных баз данных, так и для распределённых систем.

**Проблемы согласованности**
- **Сетевые задержки.** Задержки или сбои в сети увеличивают сложность обеспечения согласованности.
- **Конфликты данных.** При параллельных изменениях системы должны разрешать конфликты.
- **Цена согласованности.** Чем выше уровень согласованности, тем больше задержки и ниже производительность.    

**Уровни согласованности**
- **Строгая согласованность (Strong Consistency):** Все узлы системы видят одно и то же состояние данных в любой момент времени.
    Пример: Системы банковских счетов.
    Недостаток: Высокие задержки, так как требуется синхронизация между всеми узлами.

- **Чтение после записи (Read-After-Write Consistency):**
    После записи данных в систему любое последующее чтение возвращает обновлённое значение.
    Пример: Создание или обновление документа.

- **Монотонное чтение (Monotonic Read Consistency):**
    Если пользователь прочитал определённое значение данных, последующие чтения не вернут более старое состояние.

- **Конечная согласованность (Eventual Consistency):** Узлы системы со временем синхронизируются, но в краткосрочной перспективе данные могут быть несогласованными.
    Пример: Системы репликации данных, такие как Domain Name System

**Методы обеспечения согласованности**
- **Консенсусные алгоритмы:**
   - **Paxos, Raft:** Обеспечивают согласованность между узлами в условиях отказов. Применяются в распределённых базах данных и системах координаторов.

- **Механизмы транзакций:**
    - **Двухфазный коммит(2PC):** Обеспечивает атомарность и согласованность между участниками транзакции.
    - **Согласованное журналирование:** Используется для восстановления согласованности после сбоев.

- **Паттерны согласованности:**
  - **Eventual Consistency + Idempotence:** Для систем, допускающих временную рассогласованность.
  - **Outbox Pattern:** Для передачи данных между системами с гарантией доставки.


